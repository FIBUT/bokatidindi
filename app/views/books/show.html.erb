<% content_for :meta do %>
  <%= preload_link_tag 'https://cdn.bokatidindi.is/images/boksala-square.svg', as: 'image' %>
  <%= preload_link_tag 'https://cdn.bokatidindi.is/images/forlagid-square.svg', as: 'image' %>
  <%= preload_link_tag 'https://cdn.bokatidindi.is/images/penninn-eymundsson-square.svg', as: 'image' %>
  <%= preload_link_tag 'https://cdn.bokatidindi.is/images/salka-square.svg', as: 'image' %>
  <%= preload_link_tag 'https://cdn.bokatidindi.is/images/storytel-square.svg', as: 'image' %>

  <title>Bókatíðindi - <%= @book.full_title_with_author %></title>

  <%= tag 'meta', name: 'description', content: html_escape_once(strip_tags(@book.description).squish) %>
  <%= tag 'link', rel: 'canonical', href: url_for(controller: 'books', action: 'show', only_path: false) %>

  <%= tag 'meta', property: 'og:type', content: 'book' %>
  <% @book.book_authors.joins(:author_type, :author).where(author_type: { name: 'Höfundur' }).each do |a| %>
  <%= tag 'meta', property: 'book:author', content: a.author.name %>
  <% end %>
  <% if @book.cover_image.attached? %>
  <%= tag 'meta', property: 'og:image', content: @book.cover_image_variant_url(1200, @image_format) %>
  <%= tag 'meta', property: 'og:image:width', content: @book.cover_image.metadata[:width] %>
  <%= tag 'meta', property: 'og:image:height', content: @book.cover_image.metadata[:height] %>
  <% end %>
  <%= tag 'meta', property: 'og:site_name', content: 'Bókatíðindi' %>
  <%= tag 'meta', property: 'og:title', content: html_escape_once(@book.full_title) %>
  <% @book.book_binding_types.each do |book_binding_type| %>
  <%= tag('meta', property: 'og:isbn', content: book_binding_type.barcode) if book_binding_type.barcode %>
  <% end %>
  <%= tag 'meta', property: 'og:description', content: html_escape_once(strip_tags(@book.description).squish) %>
  <%= tag 'meta', property: 'og:url', content: url_for(controller: 'books', action: 'show', only_path: false) %>
  <%= tag 'meta', property: 'og:locale', content: 'is_IS' %>
  <%= tag 'meta', property: 'fb:app_id', content: '286582403328194' %>

  <%= tag 'meta', name: 'twitter:card', content: 'summary' %>
  <%= tag 'meta', name: 'twitter:title', content: html_escape_once(@book.full_title_with_author) %>
  <%= tag 'meta', name: 'twitter:description', content: html_escape_once(strip_tags(@book.description).squish) %>
  <% if @book.cover_image.attached? %>
  <%= tag 'meta', name: 'twitter:image', content: @book.cover_image_variant_url(1200, 'jpg') %>
  <% end %>
<% end %>

<main role="main">

<div class="container-fluid">

<div class="row">

  <section
    id="book-<%= @book.id %>"
    class="book book-single col-lg-12 col-md-12"
    aria-labelledby="book-<%= @book.id %>-hgroup"
  >

    <div class="row book-column-container m-2 p-2 py-md-5">

      <div class="col-lg-4 col-md-8 col-sm-12 offset-lg-1 order-0 order-md-1">

      <% if @book.current_edition? == false %>
        <p class="book-meta-old-edition">
        <strong>
          Athugið að þessi bók er úr eldri útgáfu Bókatíðinda og birt hér með
          fyrirvara um mögulega sé ekki um að ræða nýjustu upplýsingar.
          Hafið samband við útgefanda til að fá nánari upplýsingar um hvort
          bókin sé fáanleg.
        </strong>
        </p>
      <% end %>

      <%= render 'books/hgroup', book: @book %>

      <%= render 'books/authors', book: @book %>

      <article
        aria-label="Lýsing"
        class="book-description mb-5 bt-5 overflow-hidden"
      >
        <section id="book_description">
          <%= simple_format @book.description, tags: ['em'] %>
        </section>

        <section id="book_long_description">
          <%=  simple_format @book.long_description, tags: ['em'] %>
        </section>
      </article>

      <% if @book.audio_sample? %>
      <div id="book_audio_sample" class="mb-4 pb-4">
        <h3>Hljóðbrot</h3>
        <%= audio_tag @book.audio_sample_url, controls: true %>
      </div>
      <% end %>

      <%= render 'books/binding_types', book: @book %>

      </div>

      <div class="col-lg-4 col-md-4 col-sm-12 p-3 offset-lg-1 order-1 order-md-0">

        <figure class="figure">
          <a
            data-fancybox="samples"
            href="<%= @book.cover_image_url(@image_format, true) %>"
            title="Skoða forsíðu"
          >
            <img
              src="<%= @book.cover_image_url %>"
              <% if @book.cover_image.attached? %>
              height="<%= @book.cover_image.metadata[:height] %>"
              width="<%= @book.cover_image.metadata[:width] %>"
              <% end %>
              <% unless @book.cover_image_srcsets.blank? %>
              srcset="<%= @book.cover_image_srcsets[@image_format] %>"
              sizes="(min-resolution: 200dpi 1600px), 550px"
              <% end %>
              class="img-fluid"
              alt="Forsíða bókarinnar"
            >
          </a>
        </figure>

        <div
          class="preview-images align-self-end row"
          aria-label="Sýnishorn úr bók"
        >
          <% @book.sample_pages.each_with_index do |sp,i| %>
          <a
            class="preview-image-link col-6 col-lg-3 mb-2"
            data-fancybox="samples"
            href="<%= @book.sample_page_url(i, @image_format) %>"
            title="Skoða sýnidæmi"
          >
            <img
              class="img-fluid"
              <% unless @book.sample_pages_srcsets[@image_format].empty? %>
              srcset="<%= @book.sample_pages_srcsets[@image_format][i].join(', ') %>"
              sizes="(max-width: 576px) 150px, (max-width: 1200px) 550px, 150px"
              <% end %>
              alt="Sýnidæmi <%= i + 1 %>"
              loading="lazy"
              height="<%= sp.metadata[:height] %>"
              width="<%= sp.metadata[:width] %>"
            >
          </a>
          <% end %>
        </div>

        <div>
          <%= render 'books/meta', book: @book %>
        </div>

      </div>

    </div>
    
    <div class="col-12">
      <%= render 'shared/ecommerce_links' %>
    </div>
  </section>

</div>

</div>

</main>

<script>
Fancybox.defaults.l10n = {
  CLOSE: "Loka",
  NEXT: "Næsta mynd",
  PREV: "Fyrri mynd",
  MODAL: "Hægt er að loka þessum glugga með ESC-takkanum á lyklaborðinu",
  ERROR: "Eitthvað kom upp, reyndu aftur síðar",
  IMAGE_ERROR: "Myndin fannst ekki",
  ELEMENT_NOT_FOUND: "HTML-Element fannst ekki",
  AJAX_NOT_FOUND: "Error Loading AJAX : Not Found",
  AJAX_FORBIDDEN: "Error Loading AJAX : Forbidden",
  IFRAME_ERROR: "Error Loading Page",
  TOGGLE_ZOOM: "Súma",
  TOGGLE_SLIDESHOW: "Sjálfvirk glærusýning",
  TOGGLE_FULLSCREEN: "Fullur skjár",
  TOGGLE_THUMBS: "Smámyndir"
};
</script>